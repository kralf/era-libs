<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ERAEmbeddedRobotArmProject: i2c.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>i2c.c File Reference</h1>Basic I2C communication layer implementation. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="i2c_8h-source.html">i2c.h</a>&quot;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;termios.h&gt;</code><br>
<code>#include &quot;<a class="el" href="pdebug_8h-source.html">pdebug.h</a>&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#5f4c95c491d2bcd3f057f1f806fd2b9b">i2c_open_serial</a> (const char *device, unsigned long baud, unsigned long timeoutmiliseconde)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#0a0899cff28209e408335bcdf9e05b67">i2c_close_serial</a> (<a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a> <a class="el" href="libcan_8c.html#3127ebf018e9da62fa464d348352037d">handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#b642f96451ed8e84d29fdbd1542315a6">i2c_write</a> (<a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a> <a class="el" href="libcan_8c.html#3127ebf018e9da62fa464d348352037d">handle</a>, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> mod_addr, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> mod_reg, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> value)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#9688a1eff9c2d1a250dc63494f3deba8">i2c_read</a> (<a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a> <a class="el" href="libcan_8c.html#3127ebf018e9da62fa464d348352037d">handle</a>, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> mod_addr, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> mod_reg, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> *value)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#c0dd14b96fda6899e52924cc0a3dede4">i2c_waitup</a> (<a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a> <a class="el" href="libcan_8c.html#3127ebf018e9da62fa464d348352037d">handle</a>, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> mod_addr, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> mod_reg, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> mask)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#e4115ff1e2b7a7d24610f14473e3dddd">i2c_waitdown</a> (<a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a> <a class="el" href="libcan_8c.html#3127ebf018e9da62fa464d348352037d">handle</a>, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> mod_addr, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> mod_reg, <a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> mask)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Basic I2C communication layer implementation. 
<p>
Compiles into a relocatable object file, part of libsmartease.so. <hr><h2>Function Documentation</h2>
<a class="anchor" name="0a0899cff28209e408335bcdf9e05b67"></a><!-- doxytag: member="i2c.c::i2c_close_serial" ref="0a0899cff28209e408335bcdf9e05b67" args="(handle_t handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int i2c_close_serial           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a>&nbsp;</td>
          <td class="paramname"> <em>handle</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Close the serial port (after flushing).<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><ul>
<li>
If error -1 occurs, the file descriptor is not closed.  </li>
</ul>
</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><ul>
<li>
0 : success  </li>
<li>
-1 : couldn't drain port  </li>
<li>
-2 : couldn't flush port  </li>
<li>
-3 : couldn't close port  </li>
</ul>
</dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>handle</em>&nbsp;</td><td>
filedescriptor of serial port </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="5f4c95c491d2bcd3f057f1f806fd2b9b"></a><!-- doxytag: member="i2c.c::i2c_open_serial" ref="5f4c95c491d2bcd3f057f1f806fd2b9b" args="(const char *device, unsigned long baud, unsigned long timeoutmiliseconde)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a> i2c_open_serial           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&nbsp;</td>
          <td class="paramname"> <em>baud</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&nbsp;</td>
          <td class="paramname"> <em>timeoutmiliseconde</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Open the serial port to which the translator circuit is attached. Possible baud rates are<p>
<ul>
<li>
50  </li>
<li>
75  </li>
<li>
110  </li>
<li>
134  </li>
<li>
150  </li>
<li>
200  </li>
<li>
300  </li>
<li>
600  </li>
<li>
1200  </li>
<li>
1800  </li>
<li>
2400  </li>
<li>
4800  </li>
<li>
9600  </li>
<li>
19200  </li>
<li>
38400  </li>
<li>
57600  </li>
<li>
115200  </li>
<li>
230400  </li>
</ul>
<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><ul>
<li>
Baud rates 115200 and 230400, when given as constants in your C sourcecode, need to be specified as "115200L" and "230400L". Without the trailing "L", the compiler might not treat those large numbers correctly. </li>
<li>
On Smartease, device is "/dev/tts/0" (or maybe "/dev/tts/1", depending on the hardware version). </li>
</ul>
</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><ul>
<li>
&gt;=0 : openend filedescriptor  </li>
<li>
-1 : couldn't open port  </li>
<li>
-2 : couldn't clear termios structure  </li>
<li>
-3 : couldn't flush port  </li>
<li>
-4 : couldn't set port attributes  </li>
<li>
-5 : invalid baud rate  </li>
</ul>
</dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>device</em>&nbsp;</td><td>
device file filesystem emtry </td></tr>
<tr><td valign="top"><em>baud</em>&nbsp;</td><td>
wanted baud rate </td></tr>
<tr><td valign="top"><em>timeoutmiliseconde</em>&nbsp;</td><td>
wanted time out in ms </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="9688a1eff9c2d1a250dc63494f3deba8"></a><!-- doxytag: member="i2c.c::i2c_read" ref="9688a1eff9c2d1a250dc63494f3deba8" args="(handle_t handle, uint8 mod_addr, uint8 mod_reg, uint8 *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int i2c_read           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a>&nbsp;</td>
          <td class="paramname"> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a>&nbsp;</td>
          <td class="paramname"> <em>mod_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a>&nbsp;</td>
          <td class="paramname"> <em>mod_reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a> *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read a register of an I2C module.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><ul>
<li>
Only the 7 least significant bits of mod_addr and mod_reg are used.  </li>
</ul>
</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><ul>
<li>
0 : success  </li>
<li>
-1 : error sending the read request  </li>
<li>
-2 : couldn't drain port  </li>
<li>
-3 : error receiving the answer  </li>
<li>
-4 : read timeout  </li>
</ul>
</dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>handle</em>&nbsp;</td><td>
file descriptor </td></tr>
<tr><td valign="top"><em>mod_addr</em>&nbsp;</td><td>
i2c address of module </td></tr>
<tr><td valign="top"><em>mod_reg</em>&nbsp;</td><td>
address of register inside module </td></tr>
<tr><td valign="top"><em>value</em>&nbsp;</td><td>
the value of the register (if success) </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="e4115ff1e2b7a7d24610f14473e3dddd"></a><!-- doxytag: member="i2c.c::i2c_waitdown" ref="e4115ff1e2b7a7d24610f14473e3dddd" args="(handle_t handle, uint8 mod_addr, uint8 mod_reg, uint8 mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int i2c_waitdown           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a>&nbsp;</td>
          <td class="paramname"> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a>&nbsp;</td>
          <td class="paramname"> <em>mod_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a>&nbsp;</td>
          <td class="paramname"> <em>mod_reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a>&nbsp;</td>
          <td class="paramname"> <em>mask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Wait (indefinetely) for (any) bit of a register to become 0 without sleeping (busy wait).<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><ul>
<li>
0 : success  </li>
<li>
&lt;0 : same as <a class="el" href="i2c_8c.html#9688a1eff9c2d1a250dc63494f3deba8">i2c_read()</a>  </li>
</ul>
</dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>handle</em>&nbsp;</td><td>
file descriptor </td></tr>
<tr><td valign="top"><em>mod_addr</em>&nbsp;</td><td>
i2c address of module </td></tr>
<tr><td valign="top"><em>mod_reg</em>&nbsp;</td><td>
address of register inside module </td></tr>
<tr><td valign="top"><em>mask</em>&nbsp;</td><td>
defines the bits to wait for </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="c0dd14b96fda6899e52924cc0a3dede4"></a><!-- doxytag: member="i2c.c::i2c_waitup" ref="c0dd14b96fda6899e52924cc0a3dede4" args="(handle_t handle, uint8 mod_addr, uint8 mod_reg, uint8 mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int i2c_waitup           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a>&nbsp;</td>
          <td class="paramname"> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a>&nbsp;</td>
          <td class="paramname"> <em>mod_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a>&nbsp;</td>
          <td class="paramname"> <em>mod_reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a>&nbsp;</td>
          <td class="paramname"> <em>mask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Wait (indefinetely) for (any) bit of a register to become 1 without sleeping (busy wait).<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>Add a timeout.</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><ul>
<li>
0 : success  </li>
<li>
&lt;0 : same as <a class="el" href="i2c_8c.html#9688a1eff9c2d1a250dc63494f3deba8">i2c_read()</a>  </li>
</ul>
</dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>handle</em>&nbsp;</td><td>
file descriptor </td></tr>
<tr><td valign="top"><em>mod_addr</em>&nbsp;</td><td>
i2c address of module </td></tr>
<tr><td valign="top"><em>mod_reg</em>&nbsp;</td><td>
address of register inside module </td></tr>
<tr><td valign="top"><em>mask</em>&nbsp;</td><td>
defines the bits to wait for </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="b642f96451ed8e84d29fdbd1542315a6"></a><!-- doxytag: member="i2c.c::i2c_write" ref="b642f96451ed8e84d29fdbd1542315a6" args="(handle_t handle, uint8 mod_addr, uint8 mod_reg, uint8 value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int i2c_write           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="i2c_8h.html#5ad7d32f3a1ddabdc2933223ca6ce2ea">handle_t</a>&nbsp;</td>
          <td class="paramname"> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a>&nbsp;</td>
          <td class="paramname"> <em>mod_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a>&nbsp;</td>
          <td class="paramname"> <em>mod_reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="utility_8h.html#dde6aaee8457bee49c2a92621fe22b79">uint8</a>&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write to a register of an I2C module.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd><ul>
<li>
Only the 7 least significant bits of mod_addr and mod_reg are used.  </li>
</ul>
</dd></dl>
<dl compact><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Check that timeout is really implemented in both Windows and POSIX.</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><ul>
<li>
0 : success  </li>
<li>
-1 : write error  </li>
<li>
-2 : couldn't drain port  </li>
<li>
-3 : write timeout  </li>
</ul>
</dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>handle</em>&nbsp;</td><td>
file descriptor </td></tr>
<tr><td valign="top"><em>mod_addr</em>&nbsp;</td><td>
i2c address of module </td></tr>
<tr><td valign="top"><em>mod_reg</em>&nbsp;</td><td>
address of register inside module </td></tr>
<tr><td valign="top"><em>value</em>&nbsp;</td><td>
value to be written </td></tr>
</table>
</dl>
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Wed May 30 15:34:14 2007 for ERAEmbeddedRobotArmProject by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
