<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ERAEmbeddedRobotArmProject: libserial.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>libserial.c File Reference</h1><code>#include &quot;<a class="el" href="libserial_8h-source.html">libserial.h</a>&quot;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;strings.h&gt;</code><br>
<code>#include &lt;termios.h&gt;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>
<code>#include &quot;<a class="el" href="pdebug_8h-source.html">pdebug.h</a>&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#bb9e4c3ac8629513d0d2e39de60a0348">ASL_DEBUG</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#194bba74a22fbb720251b9228fb35ee5">canHWInit</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#36de7779c0e014e707a0865b7195ee8b">canHWEnd</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#cff9492130263abceff023e50e139d3e">my_send_can_message</a> (int can_id, char *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#ecf92da51b16707d386f41c13e46d920">read_can_message</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#72010937bbb6c98487230d9ea8441bfc">serial2epos</a> (char *data_send, char *data_recv)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#1dd32d2d4b8d7741ad83f5c6416afb5f">epos2serial</a> (int can_id, char *msg, char *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#df927a3fc908e85030371138390586f2">receive_dataframe</a> (int <a class="el" href="libserial_8c.html#6f8059414f0228f0256115e024eeed4b">fd</a>, char *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#f7eb6eb28825a220b69ccccfb897574a">send_dataframe</a> (int <a class="el" href="libserial_8c.html#6f8059414f0228f0256115e024eeed4b">fd</a>, char *data, int no_bytes_send)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#ca0d986b0584d0115ef5d4034e221c72">open_device</a> (char *name)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#c937b2dcb6184b696417205b0b9d6e2d">close_device</a> (int <a class="el" href="libserial_8c.html#6f8059414f0228f0256115e024eeed4b">fd</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#dcb6593a9808b7174045a39a7e37edcc">read_byte</a> (int <a class="el" href="libserial_8c.html#6f8059414f0228f0256115e024eeed4b">fd</a>, char *buffer)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#e7e57f53a58caeb4c04b9154cf49bc68">write_byte</a> (int <a class="el" href="libserial_8c.html#6f8059414f0228f0256115e024eeed4b">fd</a>, char data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#5ed7e2725094cef2ec0b0fee8790de0f">write_string</a> (int <a class="el" href="libserial_8c.html#6f8059414f0228f0256115e024eeed4b">fd</a>, char *data, int len)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#141d766865f933022186e50952ab74f6">c2w</a> (char *data, <a class="el" href="libserial_8h.html#285e72252c100e2508e4e933a0738f2b">word</a> *buffer, int no_chars)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#a194ecb617a84a5b437cd1297bcbe2fc">w2c</a> (<a class="el" href="libserial_8h.html#285e72252c100e2508e4e933a0738f2b">word</a> *buffer, char *data, int no_words)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#63612e304f3b1077475fa6d5c137a4d9">chg_byte_order</a> (char *data, int no_chars)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#ff3821b5df23320df3ed609af13ce8ee">chg_word_order</a> (char *data, int no_chars)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="libserial_8h.html#285e72252c100e2508e4e933a0738f2b">word</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#ec95f9f7f3f7f8c204fc27ed74a58c13">crc_alg</a> (<a class="el" href="libserial_8h.html#285e72252c100e2508e4e933a0738f2b">word</a> *buffer, int no)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#b16a3f3ef787fbc0232637959dd2cb9b">calc_crc</a> (char *data, char *crc_value, int no_char)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#9c945ee99ffee863d6d4dd4c3cf185b1">prtmsg</a> (char *desc, char *msg, int no)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#8c7335ca2e0c24ad6ca9f8ed6ec9f658">clear_iobuffer</a> (int <a class="el" href="libserial_8c.html#6f8059414f0228f0256115e024eeed4b">fd</a>)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#6f8059414f0228f0256115e024eeed4b">fd</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structCPC__MSG.html">CPC_MSG_T</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#f41524ffd812fad35d5ed54e336455d5">cpcmsg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structEPOS__ERROR__SERIAL.html">EPOS_ERROR_SERIAL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="libserial_8c.html#734e6eaa316c7574f0f382e9e44e424e">error_serial</a> [MAXERRORSERIAL]</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
<dl class="note" compact><dt><b>Note:</b></dt><dd>message-structure within libserial:</dd></dl>
message[0] OpCode CG p.15 message[1] length of data - 1!<p>
message[2] high-byte Index (data1) message[3] low-byte Index (data1)<p>
message[4] node-id (data2) message[5] subindex (data2)<p>
if four databytes message[6] high-byte additional data3 message[7] low-byte additional data3<p>
message[8] high-byte additional data4 message[9] low-byte additional data4<p>
message[10] high-byte CRC message[11] low-byte CRC <hr><h2>Define Documentation</h2>
<a class="anchor" name="bb9e4c3ac8629513d0d2e39de60a0348"></a><!-- doxytag: member="libserial.c::ASL_DEBUG" ref="bb9e4c3ac8629513d0d2e39de60a0348" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ASL_DEBUG          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="141d766865f933022186e50952ab74f6"></a><!-- doxytag: member="libserial.c::c2w" ref="141d766865f933022186e50952ab74f6" args="(char *data, word *buffer, int no_chars)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int c2w           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libserial_8h.html#285e72252c100e2508e4e933a0738f2b">word</a> *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>no_chars</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Converts an array of char to an array of word by taking two char as a word.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of words in the array </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>data</em>&nbsp;</td><td>
Array of char to convert </td></tr>
<tr><td valign="top"><em>buffer</em>&nbsp;</td><td>
Array of word to store converted values </td></tr>
<tr><td valign="top"><em>no_chars</em>&nbsp;</td><td>
Number of chars to convert </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="b16a3f3ef787fbc0232637959dd2cb9b"></a><!-- doxytag: member="libserial.c::calc_crc" ref="b16a3f3ef787fbc0232637959dd2cb9b" args="(char *data, char *crc_value, int no_char)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int calc_crc           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>crc_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>no_char</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Calculate 16-bit CRC checksum using CRC-CCITT algorithm.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Calculation has to include all bytes in the dataframe. Internally the array of char is transformed to an array of words to calculate the CRC. The CRC value as a word is then tranformed back to an array of char.</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of words build from the array. </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>data</em>&nbsp;</td><td>
Array of bytes representing the dataframe </td></tr>
<tr><td valign="top"><em>crc_value</em>&nbsp;</td><td>
Array of two bytes to store the CRC-word </td></tr>
<tr><td valign="top"><em>no_char</em>&nbsp;</td><td>
Number of bytes in the dataframe </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="36de7779c0e014e707a0865b7195ee8b"></a><!-- doxytag: member="libserial.c::canHWEnd" ref="36de7779c0e014e707a0865b7195ee8b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void canHWEnd           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Stop the serial connection by closing the device.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Same function name in <a class="el" href="libserial_8c.html">libserial.c</a> than in <a class="el" href="libcan_8c.html">libcan.c</a> to easy switch from CAN to RS232 using <a class="el" href="libepos_8c.html">libepos.c</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="194bba74a22fbb720251b9228fb35ee5"></a><!-- doxytag: member="libserial.c::canHWInit" ref="194bba74a22fbb720251b9228fb35ee5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void canHWInit           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize the serial connection by opening the device and clearing the IO-buffer.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Same function name in <a class="el" href="libserial_8c.html">libserial.c</a> than in <a class="el" href="libcan_8c.html">libcan.c</a> to easy switch from CAN to RS232 using <a class="el" href="libepos_8c.html">libepos.c</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="63612e304f3b1077475fa6d5c137a4d9"></a><!-- doxytag: member="libserial.c::chg_byte_order" ref="63612e304f3b1077475fa6d5c137a4d9" args="(char *data, int no_chars)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int chg_byte_order           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>no_chars</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Change order of databytes in the dataframe. The first two char will be ignored, the following chars will be changed by each other.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Necessary according EPOS Communication guide. </dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of changed bytes within the dataframe </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>data</em>&nbsp;</td><td>
Array of bytes for which change order </td></tr>
<tr><td valign="top"><em>no_chars</em>&nbsp;</td><td>
Number of bytes in the array (length) </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="ff3821b5df23320df3ed609af13ce8ee"></a><!-- doxytag: member="libserial.c::chg_word_order" ref="ff3821b5df23320df3ed609af13ce8ee" args="(char *data, int no_chars)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int chg_word_order           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>no_chars</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Change order of datawords (two char) in the dataframe. The first two char will be ignored, the following chars will be grouped by two and these groups changed by each other.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Necessary according EPOS Communication guide. </dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of changed bytes within the dataframe. </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>data</em>&nbsp;</td><td>
Array of char for which change order </td></tr>
<tr><td valign="top"><em>no_chars</em>&nbsp;</td><td>
Number of bytes! in the array (length) </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="8c7335ca2e0c24ad6ca9f8ed6ec9f658"></a><!-- doxytag: member="libserial.c::clear_iobuffer" ref="8c7335ca2e0c24ad6ca9f8ed6ec9f658" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int clear_iobuffer           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Clears the IO-Buffer by reading all available bytes.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><ul>
<li>0: no more bytes available</li><li>-1: unspecified error </li></ul>
</dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>fd</em>&nbsp;</td><td>
File descriptor </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="c937b2dcb6184b696417205b0b9d6e2d"></a><!-- doxytag: member="libserial.c::close_device" ref="c937b2dcb6184b696417205b0b9d6e2d" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int close_device           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Close an open device.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><ul>
<li>0: Device successfully closed</li><li>-1: Error closing device </li></ul>
</dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>fd</em>&nbsp;</td><td>
File descriptor </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="ec95f9f7f3f7f8c204fc27ed74a58c13"></a><!-- doxytag: member="libserial.c::crc_alg" ref="ec95f9f7f3f7f8c204fc27ed74a58c13" args="(word *buffer, int no)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="libserial_8h.html#285e72252c100e2508e4e933a0738f2b">word</a> crc_alg           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libserial_8h.html#285e72252c100e2508e4e933a0738f2b">word</a> *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>no</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Implementation of the CRC-CCITT algorithm.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Calculated CRC-value. </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>buffer</em>&nbsp;</td><td>
Array of words containing the dataframe </td></tr>
<tr><td valign="top"><em>no</em>&nbsp;</td><td>
Number of words in the dataframe </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="1dd32d2d4b8d7741ad83f5c6416afb5f"></a><!-- doxytag: member="libserial.c::epos2serial" ref="1dd32d2d4b8d7741ad83f5c6416afb5f" args="(int can_id, char *msg, char *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int epos2serial           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>can_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Convert the msg-array defined in <a class="el" href="libepos_8c.html">libepos.c</a> to the data-array defined in <a class="el" href="libserial_8c.html">libserial.c</a>.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This conversion is necessary, because msg-array in <a class="el" href="libepos_8c.html">libepos.c</a> relies strongly on CAN protocol.</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of bytes in the dataframe to send </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>can_id</em>&nbsp;</td><td>
Node-ID </td></tr>
<tr><td valign="top"><em>msg</em>&nbsp;</td><td>
Array of char containig the msg-array </td></tr>
<tr><td valign="top"><em>data</em>&nbsp;</td><td>
Array of char to store converted data-array </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="cff9492130263abceff023e50e139d3e"></a><!-- doxytag: member="libserial.c::my_send_can_message" ref="cff9492130263abceff023e50e139d3e" args="(int can_id, char *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void my_send_can_message           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>can_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send a message to the EPOS controller. This function will be called by <a class="el" href="libepos_8c.html">libepos.c</a> and calls the functions which do the conversion of the msg-array from <a class="el" href="libepos_8c.html">libepos.c</a> to <a class="el" href="libserial_8c.html">libserial.c</a> and backwards.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Same function name in <a class="el" href="libserial_8c.html">libserial.c</a> than in <a class="el" href="libcan_8c.html">libcan.c</a> to easy switch from CAN to RS232 using <a class="el" href="libepos_8c.html">libepos.c</a> </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>can_id</em>&nbsp;</td><td>
Native CAN-ID </td></tr>
<tr><td valign="top"><em>msg</em>&nbsp;</td><td>
Array of char representing msg in <a class="el" href="libepos_8c.html">libepos.c</a> </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="ca0d986b0584d0115ef5d4034e221c72"></a><!-- doxytag: member="libserial.c::open_device" ref="ca0d986b0584d0115ef5d4034e221c72" args="(char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int open_device           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Open a device using termios for configuration.<p>
<dl class="warning" compact><dt><b>Warning:</b></dt><dd>Function exits program, if there is no/wrong device!</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>File descriptor </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>name</em>&nbsp;</td><td>
Name of the device (/dev/ttyS0 for first serial port) </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="9c945ee99ffee863d6d4dd4c3cf185b1"></a><!-- doxytag: member="libserial.c::prtmsg" ref="9c945ee99ffee863d6d4dd4c3cf185b1" args="(char *desc, char *msg, int no)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void prtmsg           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>no</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="dcb6593a9808b7174045a39a7e37edcc"></a><!-- doxytag: member="libserial.c::read_byte" ref="dcb6593a9808b7174045a39a7e37edcc" args="(int fd, char *buffer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int read_byte           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read bytes from device.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Uses select() for non-infinit blocking (see TIMEOUTSEC).</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><ul>
<li>0: Timeout reading a byte</li><li>&gt;0: Number of bytes read</li><li>-1: Unspecified error in read() </li></ul>
</dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>fd</em>&nbsp;</td><td>
File descriptor </td></tr>
<tr><td valign="top"><em>buffer</em>&nbsp;</td><td>
Array of char containing read bytes </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="ecf92da51b16707d386f41c13e46d920"></a><!-- doxytag: member="libserial.c::read_can_message" ref="ecf92da51b16707d386f41c13e46d920" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read_can_message           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read a message to the EPOS controller. This function will be called by <a class="el" href="libepos_8c.html">libepos.c</a>, but is empty in <a class="el" href="libserial_8c.html">libserial.c</a> because there are no unexpected incoming messages in serial communication.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Same function name in <a class="el" href="libserial_8c.html">libserial.c</a> than in <a class="el" href="libcan_8c.html">libcan.c</a> to easy switch from CAN to RS232 using <a class="el" href="libepos_8c.html">libepos.c</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="df927a3fc908e85030371138390586f2"></a><!-- doxytag: member="libserial.c::receive_dataframe" ref="df927a3fc908e85030371138390586f2" args="(int fd, char *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int receive_dataframe           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="f7eb6eb28825a220b69ccccfb897574a"></a><!-- doxytag: member="libserial.c::send_dataframe" ref="f7eb6eb28825a220b69ccccfb897574a" args="(int fd, char *data, int no_bytes_send)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_dataframe           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>no_bytes_send</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="72010937bbb6c98487230d9ea8441bfc"></a><!-- doxytag: member="libserial.c::serial2epos" ref="72010937bbb6c98487230d9ea8441bfc" args="(char *data_send, char *data_recv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void serial2epos           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data_send</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data_recv</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Convert the data-array defined in <a class="el" href="libserial_8c.html">libserial.c</a> to the cpcmsg-structure defined in <a class="el" href="libepos_8c.html">libepos.c</a>. This function also calls <a class="el" href="libcan_8h.html#e127bfe18e2360c8e5addf2a926ce55e">read_SDO_msg_handler()</a> in <a class="el" href="libepos_8c.html">libepos.c</a>, which handles the incoming messages.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This conversion is necessary, because cpcmsg-structure in <a class="el" href="libepos_8c.html">libepos.c</a> assumes that the message was received by CAN protocol. </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>data_send</em>&nbsp;</td><td>
Array of char representing the dataframe sent to EPOS </td></tr>
<tr><td valign="top"><em>data_recv</em>&nbsp;</td><td>
Array of char representing the dataframe received from EPOS </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="a194ecb617a84a5b437cd1297bcbe2fc"></a><!-- doxytag: member="libserial.c::w2c" ref="a194ecb617a84a5b437cd1297bcbe2fc" args="(word *buffer, char *data, int no_words)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int w2c           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libserial_8h.html#285e72252c100e2508e4e933a0738f2b">word</a> *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>no_words</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Converts an array of word to an array of char by dividing a word into two char.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of chars in the array </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>buffer</em>&nbsp;</td><td>
Array of word to convert </td></tr>
<tr><td valign="top"><em>data</em>&nbsp;</td><td>
Array of char to store converted values </td></tr>
<tr><td valign="top"><em>no_words</em>&nbsp;</td><td>
Number of words to convert </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="e7e57f53a58caeb4c04b9154cf49bc68"></a><!-- doxytag: member="libserial.c::write_byte" ref="e7e57f53a58caeb4c04b9154cf49bc68" args="(int fd, char data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int write_byte           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write one byte to a device.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><ul>
<li>1: Byte successfully written</li><li>0: Error at writing </li></ul>
</dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>fd</em>&nbsp;</td><td>
File descriptor </td></tr>
<tr><td valign="top"><em>data</em>&nbsp;</td><td>
Byte to send </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="5ed7e2725094cef2ec0b0fee8790de0f"></a><!-- doxytag: member="libserial.c::write_string" ref="5ed7e2725094cef2ec0b0fee8790de0f" args="(int fd, char *data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int write_string           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write a string represented by an array of char to a device.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><ul>
<li>&gt;0: Number of bytes successfully written</li><li>0: Error at writing </li></ul>
</dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>fd</em>&nbsp;</td><td>
File descriptor </td></tr>
<tr><td valign="top"><em>data</em>&nbsp;</td><td>
Array of char to send </td></tr>
<tr><td valign="top"><em>len</em>&nbsp;</td><td>
Number of chars to send </td></tr>
</table>
</dl>
</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="f41524ffd812fad35d5ed54e336455d5"></a><!-- doxytag: member="libserial.c::cpcmsg" ref="f41524ffd812fad35d5ed54e336455d5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structCPC__MSG.html">CPC_MSG_T</a> <a class="el" href="libserial_8c.html#f41524ffd812fad35d5ed54e336455d5">cpcmsg</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="734e6eaa316c7574f0f382e9e44e424e"></a><!-- doxytag: member="libserial.c::error_serial" ref="734e6eaa316c7574f0f382e9e44e424e" args="[MAXERRORSERIAL]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structEPOS__ERROR__SERIAL.html">EPOS_ERROR_SERIAL</a> <a class="el" href="libserial_8c.html#734e6eaa316c7574f0f382e9e44e424e">error_serial</a>[MAXERRORSERIAL]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="6f8059414f0228f0256115e024eeed4b"></a><!-- doxytag: member="libserial.c::fd" ref="6f8059414f0228f0256115e024eeed4b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="libserial_8c.html#6f8059414f0228f0256115e024eeed4b">fd</a> = 0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 31 20:35:32 2007 for ERAEmbeddedRobotArmProject by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
